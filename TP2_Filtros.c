#include <stdio.h>
#include "board.h"
#include "peripherals.h"
#include "pin_mux.h"
#include "clock_config.h"
#include "fsl_debug_console.h"
#include "arm_math.h"

uint32_t frec_muestreo = 5;
uint32_t conteo_match = 0;
uint32_t conv_enable = 1;
uint32_t modo = 0;
uint32_t index = 0;
uint16_t muestra = 0;
int16_t muestra_q15 = 0;
int16_t datos_q15[512];
int16_t datos_procesados[512];

#define ORDEN_LP_8K 91
#define ORDEN_LP_16K 91
#define ORDEN_LP_22K 127
#define ORDEN_LP_44K 127
#define ORDEN_LP_48K 137

#define ORDEN_HP_8K 145
#define ORDEN_HP_16K 131
#define ORDEN_HP_22K 157
#define ORDEN_HP_44K 195
#define ORDEN_HP_48K 179

#define ORDEN_BP_8K 203
#define ORDEN_BP_16K 215
#define ORDEN_BP_22K 219
#define ORDEN_BP_44K 235
#define ORDEN_BP_48K 255

#define ORDEN_BR_8K 357
#define ORDEN_BR_16K 495
#define ORDEN_BR_22K 533
#define ORDEN_BR_44K 533
#define ORDEN_BR_48K 583

#define FILTER_ORDER_MAX 582
arm_fir_instance_q15 filtro; // La estructura con toda la info del filtro (coef, linea de retardo)
q15_t fir_state_q15[FILTER_ORDER_MAX + 1]; // Línea de retardo o buffer de estado.

volatile uint32_t fil_enable = 0; // 0 -> bypass, 1 -> aplica filtro
volatile uint32_t tipo_filtro = 0; // 0=Pasabajos, 1=Pasaaltos, 2=Pasabanda, 3=Rechazabanda

const q15_t fir_lp_8k[91 + 1] = {
	    -455, -832, 400, -203, 98, -26, -39, 98, -151, 193, -216, 213, -187, 131,
	    -52, -39, 138, -226, 295, -331, 328, -279, 187, -62, -88, 242, -387, 495,
	    -550, 541, -455, 295, -69, -210, 511, -800, 1042, -1196, 1222, -1075, 711, -72,
	    -950, 2625, -5983, 20529, 20529, -5983, 2625, -950, -72, 711, -1075, 1222, -1196, 1042,
	    -800, 511, -210, -69, 295, -455, 541, -550, 495, -387, 242, -88, -62, 187,
	    -279, 328, -331, 295, -226, 138, -39, -52, 131, -187, 213, -216, 193, -151,
	    98, -39, -26, 98, -203, 400, -832, -455}; // Frecuencia de paso 3500, de corte 3600 y de orden 91

const q15_t fir_lp_16k[91 + 1] = {
	    -416, -698, 82, 69, 154, -164, -125, 85, 193, -33, -213, -52, 216, 144,
	    -177, -229, 102, 295, 10, -321, -144, 298, 285, -213, -406, 69, 485, 128,
	    -498, -357, 419, 590, -239, -796, -62, 934, 485, -947, -1045, 770, 1792, -252,
	    -2959, -1186, 6141, 13212, 13212, 6141, -1186, -2959, -252, 1792, 770, -1045, -947, 485,
	    934, -62, -796, -239, 590, 419, -357, -498, 128, 485, 69, -406, -213, 285,
	    298, -144, -321, 10, 295, 102, -229, -177, 144, 216, -52, -213, -33, 193,
	    85, -125, -164, 154, 69, 82, -698, -416}; //Frecuencia de paso 3400, de corte 3600, orden 91

const q15_t fir_lp_22k[127 + 1] = {
	    -59, -701, -220, -111, 62, 134, 66, -66, -131, -72, 59, 141, 92, -49,
	    -151, -115, 33, 161, 144, -13, -167, -174, -16, 167, 206, 49, -164, -239,
	    -92, 154, 275, 141, -138, -308, -200, 111, 341, 265, -72, -374, -347, 16,
	    403, 442, 56, -433, -560, -161, 455, 718, 308, -475, -934, -541, 495, 1281,
	    957, -505, -1999, -1953, 511, 4748, 8762, 10407, 8762, 4748, 511, -1953, -1999, -505,
	    957, 1281, 495, -541, -934, -475, 308, 718, 455, -161, -560, -433, 56, 442,
	    403, 16, -347, -374, -72, 265, 341, 111, -200, -308, -138, 141, 275, 154,
	    -92, -239, -164, 49, 206, 167, -16, -174, -167, -13, 144, 161, 33, -115,
	    -151, -49, 92, 141, 59, -72, -131, -66, 66, 134, 62, -111, -220, -701,
	    -59, 0}; //Frecuencia de paso 3400, de corte 3600, orden 126

const q15_t fir_lp_44k[127 + 1] = {
	    -596, -167, -151, -108, -49, 20, 85, 131, 151, 134, 92, 29, -43, -102,
	    -134, -134, -98, -29, 56, 134, 193, 213, 187, 118, 20, -85, -174, -226,
	    -223, -161, -52, 79, 210, 305, 338, 295, 183, 20, -161, -315, -406, -403,
	    -298, -108, 138, 380, 567, 642, 573, 357, 20, -377, -750, -1006, -1058, -845,
	    -344, 423, 1389, 2444, 3463, 4306, 4866, 5059, 4866, 4306, 3463, 2444, 1389, 423,
	    -344, -845, -1058, -1006, -750, -377, 20, 357, 573, 642, 567, 380, 138, -108,
	    -298, -403, -406, -315, -161, 20, 183, 295, 338, 305, 210, 79, -52, -161,
	    -223, -226, -174, -85, 20, 118, 187, 213, 193, 134, 56, -29, -98, -134,
	    -134, -102, -43, 29, 92, 134, 151, 131, 85, 20, -49, -108, -151, -167,
	    -596, 0}; //Frecuencia de paso 3200, de corte 3600, orden 126

const q15_t fir_lp_48k[137 + 1] ={
	    -587, -125, -105, -72, -20, 39, 95, 141, 164, 167, 141, 98, 39, -20,
	    -72, -102, -105, -79, -26, 39, 108, 170, 206, 210, 177, 111, 29, -62,
	    -141, -190, -200, -164, -88, 13, 128, 229, 298, 315, 272, 177, 43, -108,
	    -246, -344, -377, -334, -213, -33, 177, 377, 528, 590, 544, 380, 118, -206,
	    -537, -813, -967, -940, -701, -239, 423, 1235, 2120, 2988, 3745, 4306, 4600, 4600,
	    4306, 3745, 2988, 2120, 1235, 423, -239, -701, -940, -967, -813, -537, -206, 118,
	    380, 544, 590, 528, 377, 177, -33, -213, -334, -377, -344, -246, -108, 43,
	    177, 272, 315, 298, 229, 128, 13, -88, -164, -200, -190, -141, -62, 29,
	    111, 177, 210, 206, 170, 108, 39, -26, -79, -105, -102, -72, -20, 39,
	    98, 141, 167, 164, 141, 95, 39, 20, -72, -105, -125, -587 }; //Frec de paso 3200, de corte 3600, orden 137

const q15_t fir_hp_8k[145 + 1] = {
	    1203, 36, 36, 36, 33, 33, 29, 29, 26, 23, 20, 13, 10, 7,
	    0, -7, -13, -20, -29, -36, -46, -52, -62, -72, -85, -95, -105, -118,
	    -128, -141, -154, -167, -180, -193, -206, -220, -233, -249, -262, -279, -288, -305,
	    -318, -334, -347, -360, -374, -390, -403, -416, -429, -439, -452, -465, -475, -488,
	    -498, -508, -518, -524, -534, -541, -550, -557, -560, -567, -570, -577, -580, -580,
	    -583, -583, 32184, -583, -583, -580, -580, -577, -570, -567, -560, -557, -550, -541,
	    -534, -524, -518, -508, -498, -488, -475, -465, -452, -439, -429, -416, -403, -390,
	    -374, -360, -347, -334, -318, -305, -288, -279, -262, -249, -233, -220, -206, -193,
	    -180, -167, -154, -141, -128, -118, -105, -95, -85, -72, -62, -52, -46, -36,
	    -29, -20, -13, -7, 0, 7, 10, 13, 20, 23, 26, 29, 29, 33,
	    33, 36, 36, 36, 1203, 0}; // Frec de paso 100, de corte 35, orden 144

const q15_t fir_hp_16k[131 + 1] = {
	    895, -121, -115, -111, -108, -108, -105, -105, -108, -111, -111, -118, -121, -125,
	    -131, -138, -141, -147, -157, -164, -170, -177, -187, -193, -203, -210, -220, -229,
	    -236, -246, -256, -262, -272, -282, -288, -298, -305, -315, -324, -331, -341, -347,
	    -354, -364, -370, -377, -383, -390, -396, -403, -406, -413, -416, -423, -426, -433,
	    -436, -439, -442, -442, -446, -446, -449, -449, -449, 32318, -449, -449, -449, -446,
	    -446, -442, -442, -439, -436, -433, -426, -423, -416, -413, -406, -403, -396, -390,
	    -383, -377, -370, -364, -354, -347, -341, -331, -324, -315, -305, -298, -288, -282,
	    -272, -262, -256, -246, -236, -229, -220, -210, -203, -193, -187, -177, -170, -164,
	    -157, -147, -141, -138, -131, -125, -121, -118, -111, -111, -108, -105, -105, -108,
	    -108, -111, -115, -121, 895, 0}; //Frec de paso 180, de corte 35, orden 130

const q15_t fir_hp_22k[157 + 1] = {
	    757, -144, -134, -125, -118, -111, -108, -105, -102, -102, -102, -102, -102, -105,
	    -108, -108, -111, -115, -118, -125, -128, -131, -138, -141, -147, -151, -157, -161,
	    -167, -170, -177, -183, -187, -193, -200, -203, -210, -216, -223, -226, -233, -236,
	    -242, -249, -252, -259, -265, -269, -275, -279, -282, -288, -292, -298, -301, -305,
	    -308, -315, -318, -321, -324, -328, -331, -334, -338, -338, -341, -344, -344, -347,
	    -347, -351, -351, -354, -354, -354, -354, -354, 32413, -354, -354, -354, -354, -354,
	    -351, -351, -347, -347, -344, -344, -341, -338, -338, -334, -331, -328, -324, -321,
	    -318, -315, -308, -305, -301, -298, -292, -288, -282, -279, -275, -269, -265, -259,
	    -252, -249, -242, -236, -233, -226, -223, -216, -210, -203, -200, -193, -187, -183,
	    -177, -170, -167, -161, -157, -151, -147, -141, -138, -131, -128, -125, -118, -115,
	    -111, -108, -108, -105, -102, -102, -102, -102, -102, -105, -108, -111, -118, -125,
	    -134, -144, 757, 0}; //Frec de paso 200, de corte 35, orden 156

const q15_t fir_hp_44k[195 + 1] = {
	    -544, -49, -49, -52, -56, -56, -59, -62, -66, -66, -69, -72, -72, -75,
	    -79, -82, -85, -85, -88, -92, -95, -98, -98, -102, -105, -108, -111, -115,
	    -118, -118, -121, -125, -128, -131, -134, -138, -141, -141, -144, -147, -151, -154,
	    -157, -161, -161, -164, -167, -170, -174, -177, -177, -180, -183, -187, -190, -190,
	    -193, -197, -200, -200, -203, -206, -206, -210, -213, -213, -216, -220, -220, -223,
	    -223, -226, -229, -229, -233, -233, -233, -236, -236, -239, -239, -239, -242, -242,
	    -242, -246, -246, -246, -246, -249, -249, -249, -249, -249, -249, -249, -249, 32518,
	    -249, -249, -249, -249, -249, -249, -249, -249, -246, -246, -246, -246, -242, -242,
	    -242, -239, -239, -239, -236, -236, -233, -233, -233, -229, -229, -226, -223, -223,
	    -220, -220, -216, -213, -213, -210, -206, -206, -203, -200, -200, -197, -193, -190,
	    -190, -187, -183, -180, -177, -177, -174, -170, -167, -164, -161, -161, -157, -154,
	    -151, -147, -144, -141, -141, -138, -134, -131, -128, -125, -121, -118, -118, -115,
	    -111, -108, -105, -102, -98, -98, -95, -92, -88, -85, -85, -82, -79, -75,
	    -72, -72, -69, -66, -66, -62, -59, -56, -56, -52, -49, -49, -544, 0};//Frec de paso 300, de corte 35, orden 194

const q15_t fir_hp_48k[179 + 1] = {
	    -583, -56, -56, -59, -62, -66, -69, -69, -72, -75, -79, -82, -85, -88,
	    -92, -92, -95, -98, -102, -105, -108, -111, -115, -118, -121, -125, -128, -131,
	    -134, -138, -141, -144, -147, -151, -154, -157, -161, -164, -167, -170, -174, -177,
	    -180, -183, -187, -190, -193, -197, -200, -200, -203, -206, -210, -213, -216, -220,
	    -220, -223, -226, -229, -229, -233, -236, -236, -239, -242, -242, -246, -246, -249,
	    -252, -252, -252, -256, -256, -259, -259, -259, -262, -262, -262, -265, -265, -265,
	    -265, -265, -265, -265, -265, 32502, -265, -265, -265, -265, -265, -265, -265, -265,
	    -262, -262, -262, -259, -259, -259, -256, -256, -252, -252, -252, -249, -246, -246,
	    -242, -242, -239, -236, -236, -233, -229, -229, -226, -223, -220, -220, -216, -213,
	    -210, -206, -203, -200, -200, -197, -193, -190, -187, -183, -180, -177, -174, -170,
	    -167, -164, -161, -157, -154, -151, -147, -144, -141, -138, -134, -131, -128, -125,
	    -121, -118, -115, -111, -108, -105, -102, -98, -95, -92, -92, -88, -85, -82,
	    -79, -75, -72, -69, -69, -66, -62, -59, -56, -56, -583, 0}; //Frec de paso 350, de corte 35, orden 178

const q15_t fir_bp_8k[203 + 1] = {
	    868, 141, -33, 138, -20, 125, 7, 88, 52, 43, 98, 7, 115, 7,
	    92, 46, 43, 92, 0, 111, -3, 82, 33, 23, 82, -23, 95, -26,
	    59, 13, -10, 62, -62, 69, -62, 16, -13, -62, 36, -118, 33, -108,
	    -36, -49, -134, 7, -190, -10, -167, -102, -88, -220, -26, -279, -52, -239,
	    -177, -131, -321, -52, -387, -92, -318, -252, -167, -436, -62, -508, -118, -406,
	    -331, -193, -570, -46, -659, -115, -501, -400, -197, -731, 26, -852, -52, -623,
	    -459, -151, -957, 226, -1163, 151, -809, -501, 29, -1438, 872, -2018, 967, -1448,
	    -521, 1357, -5944, 19857, 19857, -5944, 1357, -521, -1448, 967, -2018, 872, -1438, 29,
	    -501, -809, 151, -1163, 226, -957, -151, -459, -623, -52, -852, 26, -731, -197,
	    -400, -501, -115, -659, -46, -570, -193, -331, -406, -118, -508, -62, -436, -167,
	    -252, -318, -92, -387, -52, -321, -131, -177, -239, -52, -279, -26, -220, -88,
	    -102, -167, -10, -190, 7, -134, -49, -36, -108, 33, -118, 36, -62, -13,
	    16, -62, 69, -62, 62, -10, 13, 59, -26, 95, -23, 82, 23, 33,
	    82, -3, 111, 0, 92, 43, 46, 92, 7, 115, 7, 98, 43, 52,
	    88, 7, 125, -20, 138, -33, 141, 868 };//Frec de paso 80 y 3400, frec de corte 35 y 3500, orden de 203

const q15_t fir_bp_16k[215 + 1] = {
	    1006, 380, 82, -147, -105, 59, 82, -49, -121, -29, 75, 29, -95, -111,
	    7, 72, -16, -128, -95, 29, 52, -66, -147, -75, 43, 20, -111, -157,
	    -56, 36, -23, -154, -161, -46, 20, -72, -187, -161, -39, -10, -118, -210,
	    -161, -46, -43, -161, -233, -161, -59, -79, -200, -252, -170, -75, -108, -236,
	    -279, -183, -85, -138, -275, -311, -190, -88, -164, -324, -347, -190, -82, -197,
	    -390, -380, -167, -62, -246, -472, -400, -118, -43, -324, -570, -393, -26, -33,
	    -449, -678, -334, 105, -49, -639, -786, -190, 298, -131, -940, -885, 108, 593,
	    -354, -1494, -957, 845, 1225, -1101, -3290, -996, 6036, 12461, 12461, 6036, -996, -3290,
	    -1101, 1225, 845, -957, -1494, -354, 593, 108, -885, -940, -131, 298, -190, -786,
	    -639, -49, 105, -334, -678, -449, -33, -26, -393, -570, -324, -43, -118, -400,
	    -472, -246, -62, -167, -380, -390, -197, -82, -190, -347, -324, -164, -88, -190,
	    -311, -275, -138, -85, -183, -279, -236, -108, -75, -170, -252, -200, -79, -59,
	    -161, -233, -161, -43, -46, -161, -210, -118, -10, -39, -161, -187, -72, 20,
	    -46, -161, -154, -23, 36, -56, -157, -111, 20, 43, -75, -147, -66, 52,
	    29, -95, -128, -16, 72, 7, -111, -95, 29, 75, -29, -121, -49, 82,
	    59, -105, -147, 82, 380, 1006 }; //Frec de paso 120 - 3300, de corte 35 - 3500, orden 215

const q15_t fir_bp_22k[219 + 1] = {
	    773, 197, 131, 26, -69, -121, -115, -72, -26, -7, -26, -66, -92, -92,
	    -66, -33, -23, -43, -79, -102, -95, -66, -36, -36, -66, -105, -125, -105,
	    -66, -39, -52, -102, -144, -147, -108, -59, -46, -85, -147, -187, -164, -102,
	    -52, -66, -134, -210, -223, -161, -79, -49, -105, -206, -269, -239, -138, -56,
	    -69, -177, -292, -318, -223, -88, -36, -118, -279, -380, -331, -167, -29, -46,
	    -216, -403, -442, -288, -69, 23, -108, -364, -531, -449, -177, 59, 36, -249,
	    -567, -636, -367, 26, 200, -33, -505, -816, -668, -131, 351, 324, -269, -973,
	    -1153, -534, 472, 999, 413, -1078, -2346, -2015, 537, 4584, 8303, 9807, 8303, 4584,
	    537, -2015, -2346, -1078, 413, 999, 472, -534, -1153, -973, -269, 324, 351, -131,
	    -668, -816, -505, -33, 200, 26, -367, -636, -567, -249, 36, 59, -177, -449,
	    -531, -364, -108, 23, -69, -288, -442, -403, -216, -46, -29, -167, -331, -380,
	    -279, -118, -36, -88, -223, -318, -292, -177, -69, -56, -138, -239, -269, -206,
	    -105, -49, -79, -161, -223, -210, -134, -66, -52, -102, -164, -187, -147, -85,
	    -46, -59, -108, -147, -144, -102, -52, -39, -66, -105, -125, -105, -66, -36,
	    -36, -66, -95, -102, -79, -43, -23, -33, -66, -92, -92, -66, -26, -7,
	    -26, -72, -115, -121, -69, 26, 131, 197, 773, 0}; //Frec de paso 150 - 3300, de corte 35 - 3500, orden 218

const q15_t fir_bp_44k[235 + 1] = {
	    167, -249, -154, -108, -88, -79, -72, -66, -66, -69, -72, -79, -88, -92,
	    -92, -88, -75, -59, -39, -23, -13, -13, -23, -46, -75, -108, -138, -157,
	    -164, -154, -128, -95, -56, -26, -7, -7, -26, -62, -108, -157, -197, -216,
	    -216, -193, -151, -102, -52, -16, -7, -20, -59, -115, -177, -233, -265, -275,
	    -252, -203, -138, -72, -23, 3, -7, -52, -121, -203, -279, -328, -344, -318,
	    -256, -170, -79, -3, 36, 29, -23, -118, -229, -341, -419, -449, -419, -331,
	    -206, -69, 52, 125, 131, 59, -79, -252, -433, -570, -636, -606, -475, -269,
	    -20, 213, 374, 419, 318, 79, -269, -662, -1016, -1245, -1265, -1026, -508, 262,
	    1212, 2245, 3228, 4043, 4581, 4768, 4581, 4043, 3228, 2245, 1212, 262, -508, -1026,
	    -1265, -1245, -1016, -662, -269, 79, 318, 419, 374, 213, -20, -269, -475, -606,
	    -636, -570, -433, -252, -79, 59, 131, 125, 52, -69, -206, -331, -419, -449,
	    -419, -341, -229, -118, -23, 29, 36, -3, -79, -170, -256, -318, -344, -328,
	    -279, -203, -121, -52, -7, 3, -23, -72, -138, -203, -252, -275, -265, -233,
	    -177, -115, -59, -20, -7, -16, -52, -102, -151, -193, -216, -216, -197, -157,
	    -108, -62, -26, -7, -7, -26, -56, -95, -128, -154, -164, -157, -138, -108,
	    -75, -46, -23, -13, -13, -23, -39, -59, -75, -88, -92, -92, -88, -79,
	    -72, -69, -66, -66, -72, -79, -88, -108, -154, -249, 167, 0};//Frec de paso 250 - 3200, de corte 35 - 3500, orden 234

const q15_t fir_bp_48k[255 + 1] = {
	    170, -246, -147, -105, -85, -72, -66, -62, -59, -59, -62, -69, -75, -82,
	    -85, -85, -82, -72, -59, -43, -29, -16, -10, -10, -23, -43, -69, -95,
	    -121, -141, -151, -147, -131, -108, -75, -46, -20, -7, -7, -20, -49, -85,
	    -128, -164, -190, -200, -193, -170, -134, -92, -49, -20, -7, -13, -36, -79,
	    -131, -180, -223, -249, -249, -229, -187, -134, -79, -33, -3, 0, -23, -69,
	    -134, -200, -262, -301, -315, -298, -249, -180, -102, -33, 20, 36, 16, -36,
	    -121, -216, -308, -377, -410, -396, -341, -246, -131, -16, 72, 121, 115, 49,
	    -66, -213, -364, -492, -570, -580, -511, -370, -180, 29, 216, 347, 383, 311,
	    128, -147, -472, -793, -1045, -1173, -1121, -862, -390, 272, 1075, 1940, 2782, 3513,
	    4050, 4335, 4335, 4050, 3513, 2782, 1940, 1075, 272, -390, -862, -1121, -1173, -1045,
	    -793, -472, -147, 128, 311, 383, 347, 216, 29, -180, -370, -511, -580, -570,
	    -492, -364, -213, -66, 49, 115, 121, 72, -16, -131, -246, -341, -396, -410,
	    -377, -308, -216, -121, -36, 16, 36, 20, -33, -102, -180, -249, -298, -315,
	    -301, -262, -200, -134, -69, -23, 0, -3, -33, -79, -134, -187, -229, -249,
	    -249, -223, -180, -131, -79, -36, -13, -7, -20, -49, -92, -134, -170, -193,
	    -200, -190, -164, -128, -85, -49, -20, -7, -7, -20, -46, -75, -108, -131,
	    -147, -151, -141, -121, -95, -69, -43, -23, -10, -10, -16, -29, -43, -59,
	    -72, -82, -85, -85, -82, -75, -69, -62, -59, -59, -62, -66, -72, -85,
	    -105, -147, -246, 170 }; //Frec de paso 250 - 3200, de corte 35 - 3500, orden 255

const q15_t fir_br_8k[357 + 1] = {
	    -963, 69, 62, 59, 52, 49, 43, 36, 29, 20, 13, 7, -3, -10,
	    -16, -26, -33, -39, -46, -52, -59, -66, -72, -75, -82, -85, -88, -92,
	    -95, -95, -98, -98, -98, -98, -98, -98, -95, -95, -92, -88, -85, -82,
	    -79, -75, -72, -66, -62, -56, -49, -46, -39, -33, -26, -20, -16, -10,
	    -3, 3, 10, 16, 23, 29, 36, 43, 49, 59, 66, 72, 79, 85,
	    92, 98, 105, 108, 115, 121, 128, 134, 141, 144, 151, 157, 161, 167,
	    174, 177, 183, 187, 190, 197, 200, 203, 206, 210, 213, 216, 216, 220,
	    223, 223, 223, 226, 226, 226, 226, 226, 223, 223, 223, 220, 216, 213,
	    210, 206, 203, 200, 193, 190, 183, 177, 170, 164, 157, 151, 141, 134,
	    125, 118, 108, 98, 88, 79, 69, 59, 49, 39, 29, 16, 7, -3,
	    -16, -26, -39, -49, -59, -72, -82, -95, -105, -115, -125, -138, -147, -157,
	    -167, -177, -187, -193, -203, -213, -220, -226, -236, -242, -249, -256, -262, -265,
	    -272, -275, -282, -285, -288, -288, -292, -295, -295, -295, 32472, -295, -295, -295,
	    -292, -288, -288, -285, -282, -275, -272, -265, -262, -256, -249, -242, -236, -226,
	    -220, -213, -203, -193, -187, -177, -167, -157, -147, -138, -125, -115, -105, -95,
	    -82, -72, -59, -49, -39, -26, -16, -3, 7, 16, 29, 39, 49, 59,
	    69, 79, 88, 98, 108, 118, 125, 134, 141, 151, 157, 164, 170, 177,
	    183, 190, 193, 200, 203, 206, 210, 213, 216, 220, 223, 223, 223, 226,
	    226, 226, 226, 226, 223, 223, 223, 220, 216, 216, 213, 210, 206, 203,
	    200, 197, 190, 187, 183, 177, 174, 167, 161, 157, 151, 144, 141, 134,
	    128, 121, 115, 108, 105, 98, 92, 85, 79, 72, 66, 59, 49, 43,
	    36, 29, 23, 16, 10, 3, -3, -10, -16, -20, -26, -33, -39, -46,
	    -49, -56, -62, -66, -72, -75, -79, -82, -85, -88, -92, -95, -95, -98,
	    -98, -98, -98, -98, -98, -95, -95, -92, -88, -85, -82, -75, -72, -66,
	    -59, -52, -46, -39, -33, -26, -16, -10, -3, 7, 13, 20, 29, 36,
	    43, 49, 52, 59, 62, 69, -963, 0}; //Frec de paso 20 - 80, de corte 42,5 - 57,5 (15 Hz con 50 entre medio), orden 356

const q15_t fir_br_16k[495 + 1] = {
	    -865, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,
	    23, 23, 26, 26, 26, 26, 26, 29, 29, 29, 29, 33, 33, 33,
	    36, 36, 36, 39, 39, 39, 43, 43, 46, 46, 46, 49, 49, 52,
	    52, 52, 56, 56, 59, 59, 62, 62, 62, 66, 66, 69, 69, 72,
	    72, 75, 75, 75, 79, 79, 82, 82, 85, 85, 85, 88, 88, 92,
	    92, 92, 95, 95, 95, 98, 98, 102, 102, 102, 105, 105, 105, 105,
	    108, 108, 108, 108, 111, 111, 111, 111, 111, 115, 115, 115, 115, 115,
	    115, 115, 115, 115, 115, 115, 115, 115, 115, 115, 115, 115, 115, 115,
	    115, 111, 111, 111, 111, 108, 108, 108, 108, 105, 105, 105, 102, 102,
	    98, 98, 95, 95, 95, 92, 88, 88, 85, 85, 82, 82, 79, 75,
	    75, 72, 69, 66, 66, 62, 59, 56, 56, 52, 49, 46, 43, 39,
	    36, 36, 33, 29, 26, 23, 20, 16, 13, 10, 7, 3, 0, -3,
	    -7, -10, -13, -16, -20, -23, -26, -29, -33, -36, -43, -46, -49, -52,
	    -56, -59, -62, -66, -69, -72, -75, -79, -82, -85, -88, -92, -95, -98,
	    -102, -105, -108, -111, -115, -118, -121, -125, -128, -131, -134, -138, -138, -141,
	    -144, -147, -151, -151, -154, -157, -161, -161, -164, -167, -167, -170, -174, -174,
	    -177, -177, -180, -180, -183, -183, -187, -187, -187, -190, -190, -190, -193, -193,
	    -193, -197, -197, -197, -197, -197, -197, -197, -197, 32570, -197, -197, -197, -197,
	    -197, -197, -197, -197, -193, -193, -193, -190, -190, -190, -187, -187, -187, -183,
	    -183, -180, -180, -177, -177, -174, -174, -170, -167, -167, -164, -161, -161, -157,
	    -154, -151, -151, -147, -144, -141, -138, -138, -134, -131, -128, -125, -121, -118,
	    -115, -111, -108, -105, -102, -98, -95, -92, -88, -85, -82, -79, -75, -72,
	    -69, -66, -62, -59, -56, -52, -49, -46, -43, -36, -33, -29, -26, -23,
	    -20, -16, -13, -10, -7, -3, 0, 3, 7, 10, 13, 16, 20, 23,
	    26, 29, 33, 36, 36, 39, 43, 46, 49, 52, 56, 56, 59, 62,
	    66, 66, 69, 72, 75, 75, 79, 82, 82, 85, 85, 88, 88, 92,
	    95, 95, 95, 98, 98, 102, 102, 105, 105, 105, 108, 108, 108, 108,
	    111, 111, 111, 111, 111, 115, 115, 115, 115, 115, 115, 115, 115, 115,
	    115, 115, 115, 115, 115, 115, 115, 115, 115, 115, 111, 111, 111, 111,
	    111, 108, 108, 108, 108, 105, 105, 105, 105, 102, 102, 102, 98, 98,
	    95, 95, 95, 92, 92, 92, 88, 88, 85, 85, 85, 82, 82, 79,
	    79, 75, 75, 75, 72, 72, 69, 69, 66, 66, 62, 62, 59, 59,
	    56, 56, 52, 52, 52, 49, 49, 46, 46, 46, 43, 43, 39, 39,
	    39, 36, 36, 36, 33, 33, 33, 29, 29, 29, 29, 26, 26, 26,
	    26, 26, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,
	    -865, 0}; //Frec de paso 10 - 90, corte 42,5 - 57,5, orden 494

const q15_t fir_br_22k[533 + 1] = {
	    655, 33, 36, 36, 36, 36, 39, 39, 39, 39, 43, 43, 43, 43,
	    46, 46, 46, 49, 49, 49, 49, 52, 52, 52, 52, 56, 56, 56,
	    56, 59, 59, 59, 59, 62, 62, 62, 66, 66, 66, 66, 69, 69,
	    69, 69, 69, 72, 72, 72, 72, 72, 75, 75, 75, 75, 75, 75,
	    79, 79, 79, 79, 79, 79, 82, 82, 82, 82, 82, 82, 82, 82,
	    82, 82, 85, 85, 85, 85, 85, 85, 85, 85, 85, 85, 85, 85,
	    85, 85, 85, 85, 85, 85, 85, 82, 82, 82, 82, 82, 82, 82,
	    82, 79, 79, 79, 79, 79, 79, 75, 75, 75, 75, 72, 72, 72,
	    72, 69, 69, 69, 69, 66, 66, 66, 62, 62, 62, 59, 59, 56,
	    56, 56, 52, 52, 49, 49, 49, 46, 46, 43, 43, 39, 39, 36,
	    36, 33, 33, 29, 29, 26, 26, 23, 20, 20, 16, 16, 13, 13,
	    10, 7, 7, 3, 3, 0, -3, -3, -7, -7, -10, -13, -13, -16,
	    -20, -20, -23, -26, -26, -29, -33, -33, -36, -39, -39, -43, -46, -46,
	    -49, -52, -52, -56, -59, -59, -62, -66, -66, -69, -69, -72, -75, -75,
	    -79, -82, -82, -85, -88, -88, -92, -92, -95, -98, -98, -102, -102, -105,
	    -108, -108, -111, -111, -115, -115, -118, -118, -121, -125, -125, -128, -128, -128,
	    -131, -131, -134, -134, -138, -138, -141, -141, -141, -144, -144, -147, -147, -147,
	    -151, -151, -151, -154, -154, -154, -154, -157, -157, -157, -157, -161, -161, -161,
	    -161, -161, -161, -164, -164, -164, -164, -164, -164, -164, -164, -164, -164, -164,
	    32603, -164, -164, -164, -164, -164, -164, -164, -164, -164, -164, -164, -161, -161,
	    -161, -161, -161, -161, -157, -157, -157, -157, -154, -154, -154, -154, -151, -151,
	    -151, -147, -147, -147, -144, -144, -141, -141, -141, -138, -138, -134, -134, -131,
	    -131, -128, -128, -128, -125, -125, -121, -118, -118, -115, -115, -111, -111, -108,
	    -108, -105, -102, -102, -98, -98, -95, -92, -92, -88, -88, -85, -82, -82,
	    -79, -75, -75, -72, -69, -69, -66, -66, -62, -59, -59, -56, -52, -52,
	    -49, -46, -46, -43, -39, -39, -36, -33, -33, -29, -26, -26, -23, -20,
	    -20, -16, -13, -13, -10, -7, -7, -3, -3, 0, 3, 3, 7, 7,
	    10, 13, 13, 16, 16, 20, 20, 23, 26, 26, 29, 29, 33, 33,
	    36, 36, 39, 39, 43, 43, 46, 46, 49, 49, 49, 52, 52, 56,
	    56, 56, 59, 59, 59, 59, 62, 62, 62, 66, 66, 66, 66, 69,
	    69, 69, 69, 69, 72, 72, 72, 72, 72, 75, 75, 75, 75, 75,
	    75, 79, 79, 79, 79, 79, 79, 82, 82, 82, 82, 82, 82, 82,
	    82, 82, 85, 85, 85, 85, 85, 85, 85, 85, 85, 85, 85, 85,
	    85, 85, 85, 85, 82, 82, 82, 82, 82, 82, 82, 82, 79, 79,
	    79, 79, 79, 79, 75, 75, 75, 75, 72, 72, 72, 72, 69, 69,
	    69, 69, 66, 66, 66, 62, 62, 62, 59, 59, 56, 56, 56, 52,
	    52, 49, 49, 49, 46, 46, 43, 43, 39, 39, 36, 36, 36, 655, 0}; //Frec de paso 1-100, de corte 42,5 - 57,5, orden 532

const q15_t fir_br_44k[533 + 1] = {
	    2336, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -7,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13,
	    -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13,
	    -13, -13, -13, -13, -13, -13, -13, -13, -13, -16, -16, -16, -16, -16,
	    -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16,
	    -16, -16, -16, -16, -16, -16, -16, -16, -16, -20, -20, -20, -20, -20,
	    -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20,
	    -20, -20, -20, -20, -20, -20, -20, -20, -23, -23, -23, -23, -23, -23,
	    -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23,
	    -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23,
	    -23, -23, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, 32741, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -23, -23, -23, -23, -23,
	    -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23,
	    -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23,
	    -23, -23, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20,
	    -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20,
	    -20, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16,
	    -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16,
	    -16, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13,
	    -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13,
	    -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, 2336, 0};//Frec de paso 1 - 100, frec de corte 42.5, 57.5, orden 532, Astop = 10 dB

const q15_t fir_br_48k[583 + 1] = {
	    2333, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7,
	    -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7,
	    -7, -7, -7, -7, -7, -10, -7, -10, -7, -10, -7, -10, -7, -7,
	    -10, -7, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -13, -13, -13, -13,
	    -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13,
	    -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13,
	    -13, -13, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16,
	    -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16,
	    -16, -16, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20,
	    -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20,
	    -20, -20, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23,
	    -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23,
	    -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    32741, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26, -26,
	    -26, -26, -26, -26, -26, -23, -23, -23, -23, -23, -23, -23, -23, -23,
	    -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23,
	    -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23, -23,
	    -23, -23, -23, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20,
	    -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20, -20,
	    -20, -20, -20, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16,
	    -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16, -16,
	    -16, -16, -16, -16, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13,
	    -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13,
	    -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -13, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10,
	    -10, -10, -10, -10, -10, -10, -10, -7, -10, -7, -7, -10, -7, -10,
	    -7, -10, -7, -10, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7,
	    -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7, -7,
	    2333, 0}; //Frec de paso 1 - 100, de corte 42.5, 57.5, orden 582, Astop 10 dB

void Apago_Leds();
void Prendo_Rojo();
void MostrarDAC();
void ActualizarCoeficientes();

int main(void) {

    BOARD_InitBootPins();
    BOARD_InitBootClocks();
    BOARD_InitLEDsPins();
	BOARD_InitBUTTONsPins();
	BOARD_InitDACPins();
	BOARD_InitADCPins();
	BOARD_InitBootPeripherals();
#ifndef BOARD_INIT_DEBUG_CONSOLE_PERIPHERAL
    BOARD_InitDebugConsole();
#endif


    PRINTF("Sistema listo. Presione RUN/STOP para comenzar.\r\n");
    PRINTF("Instrucciones: 'b' para Bypass, 'f' para cambiar filtro.\r\n");

    while(1) {
        if(frec_muestreo != 5){
			char ch = GETCHAR();
			if (ch != -1) {
						switch(ch) {
							case 'b': // Tecla 'b' para el Bypass
								fil_enable = (fil_enable + 1) % 2; // Conmuta la bandera
								if (fil_enable) {
									PRINTF("Filtro ACTIVADO\r\n");
								} else {
									PRINTF("Filtro en BYPASS\r\n");
								}
								break;

							case 'f': // Tecla 'f' para cambiar de Filtro
								tipo_filtro = (tipo_filtro + 1) % 4; // Avanza al siguiente filtro
								ActualizarCoeficientes();
								switch(tipo_filtro){
									case 0:
										PRINTF("Filtro: Pasabajos\r\n");
									break;
									case 1:
										PRINTF("Filtro: Pasaaltos\r\n");
									break;
									case 2:
										PRINTF("Filtro: Pasabandas\r\n");
									break;
									case 3:
										PRINTF("Filtro: Rechazabanda\r\n");
									break;
								}
								PRINTF("Cambiando a Filtro tipo: %d\r\n", tipo_filtro);
								break;

							// Opcional: Atajos para seleccionar un filtro directamente
							case '0': tipo_filtro = 0; ActualizarCoeficientes(); PRINTF("Filtro: Pasabajos\r\n"); break;
							case '1': tipo_filtro = 1; ActualizarCoeficientes(); PRINTF("Filtro: Pasaaltos\r\n"); break;
							case '2': tipo_filtro = 2; ActualizarCoeficientes(); PRINTF("Filtro: Pasabanda\r\n"); break;
							case '3': tipo_filtro = 3; ActualizarCoeficientes(); PRINTF("Filtro: Rechazabanda\r\n"); break;
						}
			}
        }
    }
    return 0 ;
}

void Apago_Leds(){
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_GREEN_GPIO, BOARD_INITLEDSPINS_LED_GREEN_PIN, 1);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_BLUE_GPIO, BOARD_INITLEDSPINS_LED_BLUE_PIN, 1);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_RED_GPIO, BOARD_INITLEDSPINS_LED_RED_PIN, 1);
}

void Prendo_Rojo(){
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_GREEN_GPIO, BOARD_INITLEDSPINS_LED_GREEN_PIN, 1);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_BLUE_GPIO, BOARD_INITLEDSPINS_LED_BLUE_PIN, 1);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_RED_GPIO, BOARD_INITLEDSPINS_LED_RED_PIN, 0);
}

void Prendo_Azul(){
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_GREEN_GPIO, BOARD_INITLEDSPINS_LED_GREEN_PIN, 1);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_BLUE_GPIO, BOARD_INITLEDSPINS_LED_BLUE_PIN, 0);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_RED_GPIO, BOARD_INITLEDSPINS_LED_RED_PIN, 1);
}

void Prendo_Verde(){
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_GREEN_GPIO, BOARD_INITLEDSPINS_LED_GREEN_PIN, 0);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_BLUE_GPIO, BOARD_INITLEDSPINS_LED_BLUE_PIN, 1);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_RED_GPIO, BOARD_INITLEDSPINS_LED_RED_PIN, 1);
}

void Prendo_Violeta(){
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_GREEN_GPIO, BOARD_INITLEDSPINS_LED_GREEN_PIN, 1);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_BLUE_GPIO, BOARD_INITLEDSPINS_LED_BLUE_PIN, 0);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_RED_GPIO, BOARD_INITLEDSPINS_LED_RED_PIN, 0);
}

void Prendo_Cyan(){
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_GREEN_GPIO, BOARD_INITLEDSPINS_LED_GREEN_PIN, 0);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_BLUE_GPIO, BOARD_INITLEDSPINS_LED_BLUE_PIN, 0);
	GPIO_PinWrite(BOARD_INITLEDSPINS_LED_RED_GPIO, BOARD_INITLEDSPINS_LED_RED_PIN, 1);
}

void Match_44k(uint32_t flag){

	// Si el muestreo está habilitado, según la frecuencia seleccionada, gatilla el ADC con la periodicidad correspondiente
		conteo_match ++;
		switch(frec_muestreo){
		case(2):
		if(conteo_match==2){
			if(conv_enable == 1){
				LPADC_DoSoftwareTrigger(ADC0, 1U);
			}
			conteo_match = conteo_match % 2;
			MostrarDAC();
		}
		break;
		case(3):
		if(conv_enable == 1){
				LPADC_DoSoftwareTrigger(ADC0, 1U);
		}
		MostrarDAC();
		break;
		}
}

void Match_48k(uint32_t flag){

	// Si el muestreo está habilitado, según la frecuencia seleccionada, gatilla el ADC con la periodicidad correspondiente
		conteo_match++;
		switch(frec_muestreo){
		case(0):
				if(conteo_match==6){
					if(conv_enable == 1){
						LPADC_DoSoftwareTrigger(ADC0, 1U);
					}
					conteo_match = conteo_match % 6;
					MostrarDAC();
				}
		break;
		case(1):
				if(conteo_match==3){
					if(conv_enable == 1){
							LPADC_DoSoftwareTrigger(ADC0, 1U);
					}
					conteo_match = conteo_match % 3;
					MostrarDAC();
				}
		break;
		case(4):
				if(conv_enable == 1){
					LPADC_DoSoftwareTrigger(ADC0, 1U);
				}
				MostrarDAC();
		break;
		}
}

void GPIO0_INT_0_IRQHANDLER(void) {

	/* Get pin flags 0 */
	uint32_t pin_flags0 = GPIO_GpioGetInterruptChannelFlags(GPIO0, 0U);

	// No hace nada hasta que se presione el botón que comienza el muestreo
	// Actualiza la frecuencia de muestreo, eligiendo el clock correspondiente en cada caso y encendiendo el led correspondiente
		if(conv_enable){
			if(frec_muestreo != 5){
				switch(modo){
				case(0):
					Prendo_Azul();
					frec_muestreo = 1;//16kHz
				break;
				case(1):
					Prendo_Verde();
					frec_muestreo = 2;//22kHz
					CTIMER_StopTimer(CTIMER0);
					CTIMER_Reset(CTIMER1);
					CTIMER_StartTimer(CTIMER1);
				break;
				case(2):
					Prendo_Violeta();
					frec_muestreo = 3;//44kHz
				break;
				case(3):
					Prendo_Cyan();
					frec_muestreo = 4;//48kHz
					CTIMER_StopTimer(CTIMER1);
					CTIMER_Reset(CTIMER0);
					CTIMER_StartTimer(CTIMER0);
				break;
				case(4):
					Prendo_Rojo();
					frec_muestreo = 0;//8kHz
				}
				modo = (modo + 1)%5;	// Actualiza el buffer circular
				conteo_match = 0;		// Reinicia el valor de esta variable

				ActualizarCoeficientes();
			}
		}
	/* Clear pin flags 0 */
	GPIO_GpioClearInterruptChannelFlags(GPIO0, pin_flags0, 0U);
	  /* Add for ARM errata 838869, affects Cortex-M4, Cortex-M4F
	     Store immediate overlapping exception return operation might vector to incorrect interrupt. */
	  #if defined __CORTEX_M && (__CORTEX_M == 4U)
	    __DSB();
	  #endif
}

void GPIO0_INT_1_IRQHANDLER(void) {

  /* Get pin flags 1 */
  uint32_t pin_flags1 = GPIO_GpioGetInterruptChannelFlags(GPIO0, 1U);

  // Prepara el sistema para la adquisición de datos (solo la primera vez que se presiona el botón al encender el sistema)
	  if(frec_muestreo == 5){
		  frec_muestreo = 0;
		  conteo_match = 0;
		  Apago_Leds();
		  Prendo_Rojo();
		  CTIMER_Reset(CTIMER0);
		  CTIMER_StartTimer(CTIMER0);
	  }
	  else{
		  conv_enable = (conv_enable + 1)%2; //Cambia la bandera para habilitar el muestreo
		  conteo_match = 0;
	  }
  /* Clear pin flags 1 */
  GPIO_GpioClearInterruptChannelFlags(GPIO0, pin_flags1, 1U);

  /* Add for ARM errata 838869, affects Cortex-M4, Cortex-M4F
     Store immediate overlapping exception return operation might vector to incorrect interrupt. */
  #if defined __CORTEX_M && (__CORTEX_M == 4U)
    __DSB();
  #endif
}

void ADC0_IRQHANDLER(void) {

  uint32_t trigger_status_flag;
  uint32_t status_flag;
  /* Trigger interrupt flags */
  trigger_status_flag = LPADC_GetTriggerStatusFlags(ADC0_PERIPHERAL);
  /* Interrupt flags */
  status_flag = LPADC_GetStatusFlags(ADC0_PERIPHERAL);
  /* Clears trigger interrupt flags */
  LPADC_ClearTriggerStatusFlags(ADC0_PERIPHERAL, trigger_status_flag);
  /* Clears interrupt flags */
  LPADC_ClearStatusFlags(ADC0_PERIPHERAL, status_flag);

  	// Si la conversión del ADC está terminada, se guarda el dato en el buffer ajustado a q15
		static lpadc_conv_result_t res;
		if(LPADC_GetConvResult(ADC0, &res, 0U)){
			muestra = (uint16_t)res.convValue;
			muestra_q15 = (int16_t)((uint16_t)muestra - 32768);
			datos_q15[index] = muestra_q15;

			if(fil_enable){
				arm_fir_q15(&filtro, &muestra_q15, &datos_procesados[index], 1);
				// Este es mi filtro, aplicaselo a esta muestra, guardalo acá y que sea una sola muestra)
			}
			else{
				datos_procesados[index] = muestra_q15;
				// Bypass
			}
		}

  /* Add for ARM errata 838869, affects Cortex-M4, Cortex-M4F
     Store immediate overlapping exception return operation might vector to incorrect interrupt. */
  #if defined __CORTEX_M && (__CORTEX_M == 4U)
    __DSB();
  #endif
}

void MostrarDAC(void){

	uint16_t valor_dac = (uint16_t)(datos_procesados[index] + 32768);

	DAC_SetData(DAC0, valor_dac >> 4);	//Se ajusta a 12 bits el dato de formato q15 para el DAC
	index = (index + 1) % 512; 		//Se actualiza el índice de recorrido del buffer
}

void ActualizarCoeficientes(void){
    // Selecciona el array de coeficientes y el orden según la frec_muestreo y el tipo de filtro.

	const q15_t* pCoeficientes;
	uint16_t numCoefs;

    switch(tipo_filtro){
        case 0: // --- PASA BAJOS ---
            switch(frec_muestreo){
                case 0: // 8k
                    pCoeficientes = fir_lp_8k;
                    numCoefs = ORDEN_LP_8K + 1;
                    break;
                case 1: // 16k
                    pCoeficientes = fir_lp_16k;
                    numCoefs = ORDEN_LP_16K + 1;
                    break;
                case 2: // 22k
                	pCoeficientes = fir_lp_22k;
                	numCoefs = ORDEN_LP_22K + 1;
                	break;
                case 3: // 44k
                	pCoeficientes = fir_lp_44k;
                	numCoefs = ORDEN_LP_44K + 1;
                	break;
                case 4: // 48k
                	pCoeficientes = fir_lp_48k;
                	numCoefs = ORDEN_LP_48K + 1;
                	break;
            }
            break;
        case 1: // --- PASA ALTOS ---
        	switch(frec_muestreo){
				case 0: // 8k
					pCoeficientes = fir_hp_8k;
					numCoefs = ORDEN_HP_8K + 1;
					break;
				case 1: // 16k
					pCoeficientes = fir_hp_16k;
					numCoefs = ORDEN_HP_16K + 1;
					break;
				case 2: // 22k
					pCoeficientes = fir_hp_22k;
					numCoefs = ORDEN_HP_22K + 1;
					break;
				case 3: // 44k
					pCoeficientes = fir_hp_44k;
					numCoefs = ORDEN_HP_44K + 1;
					break;
				case 4: // 48k
					pCoeficientes = fir_hp_48k;
					numCoefs = ORDEN_HP_48K + 1;
					break;
			}
            break;
        case 2: 	//--PASABANDA--
        	switch(frec_muestreo){
				case 0: // 8k
					pCoeficientes = fir_bp_8k;
					numCoefs = ORDEN_BP_8K + 1;
					break;
				case 1: // 16k
					pCoeficientes = fir_bp_16k;
					numCoefs = ORDEN_BP_16K + 1;
					break;
				case 2: // 22k
					pCoeficientes = fir_bp_22k;
					numCoefs = ORDEN_BP_22K + 1;
					break;
				case 3: // 44k
					pCoeficientes = fir_bp_44k;
					numCoefs = ORDEN_BP_44K + 1;
					break;
				case 4: // 48k
					pCoeficientes = fir_bp_48k;
					numCoefs = ORDEN_BP_48K + 1;
					break;
			}
			break;
		case 3:		//--RECHAZA BANDA--
			switch(frec_muestreo){
				case 0: // 8k
					pCoeficientes = fir_br_8k;
					numCoefs = ORDEN_BR_8K + 1;
					break;
				case 1: // 16k
					pCoeficientes = fir_br_16k;
					numCoefs = ORDEN_BR_16K + 1;
					break;
				case 2: // 22k
					pCoeficientes = fir_br_22k;
					numCoefs = ORDEN_BR_22K + 1;
					break;
				case 3: // 44k
					pCoeficientes = fir_br_44k;
					numCoefs = ORDEN_BR_44K + 1;
					break;
				case 4: // 48k
					pCoeficientes = fir_br_48k;
					numCoefs = ORDEN_BR_48K + 1;
					break;
			}
			break;
    }
    arm_fir_init_q15(&filtro, numCoefs, (q15_t*)pCoeficientes, &fir_state_q15[0], 1);
    // Preparame este filtro, con estos coefs, que son ESTOS que hay acá, y usa ESTE buffer como memoria interna
}
